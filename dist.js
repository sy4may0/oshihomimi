!function(e){var r={};function n(t){if(r[t])return r[t].exports;var o=r[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=r,n.d=function(e,r,t){n.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,r){if(1&r&&(e=n(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)n.d(t,o,function(r){return e[r]}.bind(null,o));return t},n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,"a",r),r},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.p="",n(n.s=16)}([function(e,r){e.exports=require("@babel/runtime/regenerator")},function(e,r){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,r){e.exports=require("mongoose")},function(e,r){e.exports=require("express-promise-router")},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("dotenv")},function(e){e.exports=JSON.parse('{"users":[{"text":"岩田 悠史","value":"y_iwata"}],"projects":["維持管理","INITS","MINITS","INPS","ENP","uFDS","ODDS","デブリ","SMACS","SCi","UPAS","NIECE","審査会","G-portal","GPM","GOSAT系","センチ","EACH","E-XING","BEACH","MOS","ALOS-2","その他","休暇","午前半休","午後半休","休日（祝日）"],"categories":["申請書対応","異障対応（ハード）","異障対応（ソフト）","要望事項対応","日次作業","週次作業","月次作業","月例報告作成","機器点検・定期メンテナンス","提案活動(商談）","構築(設計・構築・試験含む）","会議・打合せ","教育（スキルUPなど）","朝礼・夕会","打上げ対応","雑務","その他"]}')},function(e,r){e.exports=require("path")},function(e,r){e.exports=require("cors")},function(e,r){e.exports=require("http-errors")},function(e,r){e.exports=require("cookie-parser")},function(e,r){e.exports=require("morgan")},function(e,r){e.exports=require("http")},function(e,r){e.exports=require("debug")},function(e,r,n){var t=n(4).Router();n(6);t.get("/",(function(e,r,n){r.render("index",{title:"Express"})})),e.exports=t},function(e,r){e.exports=require("axios")},function(e,r,n){"use strict";n.r(r);var t=n(9),o=n.n(t),s=n(4),a=n.n(s),u=n(7),i=n.n(u),c=n(10),d=n.n(c),p=n(11),f=n.n(p),l=n(12),y=n.n(l),v=n(13),g=n.n(v),m=n(2),b=n.n(m),h=n(8),x=n.n(h),S=n(5),w=n.n(S),j=n(14),q=n.n(j),A=n(0),I=n.n(A),O=n(1),_=n.n(O),k=n(3),E=n.n(k),P=E()(),C=n(6);P.get("/",function(){var e=_()(I.a.mark((function e(r,n){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.json(C);case 1:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}());var M=P,U=new(0,b.a.Schema)({name:String,user:String,project:String,category:String,description:String,closed:Boolean}),N=b.a.model("Task",U),T=E()();T.get("/",function(){var e=_()(I.a.mark((function e(r,n){var t,o;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={},void 0!==r.query.user&&(t={user:r.query.user}),e.next=4,N.find(t);case 4:o=e.sent,n.json(o);case 6:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}()),T.get("/:id",function(){var e=_()(I.a.mark((function e(r,n){var t,o;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.params.id,e.next=3,N.findById(t);case 3:o=e.sent,n.json(o);case 5:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}()),T.post("/",function(){var e=_()(I.a.mark((function e(r,n){var t;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new N).name=r.body.name,t.user=r.body.user,t.project=r.body.project,t.category=r.body.category,t.description=r.body.description,t.closed=r.body.closed,e.next=9,t.save();case 9:n.json({result:"success"});case 10:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}()),T.post("/:id",function(){var e=_()(I.a.mark((function e(r,n){var t,o;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.params.id,console.log(r.body),e.next=4,N.findById(t);case 4:return(o=e.sent).name=r.body.name,o.user=r.body.user,o.project=r.body.project,o.category=r.body.category,o.description=r.body.description,o.closed=r.body.closed,e.next=13,o.save();case 13:n.json({result:"success"});case 14:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}()),T.delete("/:id",function(){var e=_()(I.a.mark((function e(r,n){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.remove({_id:r.params.id});case 2:n.json({result:"success"});case 3:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}());var R=T,$=new(0,b.a.Schema)({date:String,user:String,unexpected:Boolean,project:String,category:String,description:String,scheduled:String,actual:String,closed:Boolean,issues:String}),B=b.a.model("Achievement",$);function G(e,r){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,r){if(!e)return;if("string"==typeof e)return L(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return L(e,r)}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw s}}}}function L(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}var D=E()();D.get("/",function(){var e=_()(I.a.mark((function e(r,n){var t,o;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={date:{}},void 0!==r.query.user&&(t.user=r.query.user),void 0!==r.query.gte&&(t.date.$gte=r.query.gte),void 0!==r.query.lte&&(t.date.$lte=r.query.lte),e.next=6,B.find(t);case 6:o=e.sent,n.json(o);case 8:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}()),D.get("/:id",function(){var e=_()(I.a.mark((function e(r,n){var t,o;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.params.id,e.next=3,B.findById(t);case 3:o=e.sent,n.json(o);case 5:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}()),D.post("/",function(){var e=_()(I.a.mark((function e(r,n){var t,o,s,a,u,i,c,d,p,f,l,y,v,g;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return[],e.next=3,B.find({$and:[{description:{$eq:r.body.description}},{user:{$eq:r.body.user}},{project:{$eq:r.body.project}},{category:{$eq:r.body.category}}]});case 3:t=e.sent,o=new Map,s=G(t);try{for(s.s();!(a=s.n()).done;)u=a.value,o.set(u.date,u)}catch(e){s.e(e)}finally{s.f()}i=[],c=G(r.body.dates);try{for(c.s();!(d=c.n()).done;)p=d.value,(f=new B).date=p,f.user=r.body.user,f.unexpected=r.body.unexpected,f.project=r.body.project,f.category=r.body.category,f.description=r.body.description,f.scheduled=r.body.scheduled,f.actual=r.body.actual,f.closed=r.body.closed,f.issues=r.body.issues,i.push(f)}catch(e){c.e(e)}finally{c.f()}for(l=0,y=i;l<y.length;l++)v=y[l],o.has(v.date)?(v._id=o.get(v.date)._id,o.set(v.date,v)):o.set(v.date,v);return g=Array.from(o.values()),e.next=14,Promise.all(g.map(function(){var e=_()(I.a.mark((function e(r){var n;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={_id:r._id},e.next=3,B.findOneAndUpdate(n,r,{upsert:!0});case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()));case 14:n.json({result:"success"});case 15:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}()),D.post("/:id",function(){var e=_()(I.a.mark((function e(r,n){var t,o;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.params.id,e.next=3,B.findById(t);case 3:return(o=e.sent).date=r.body.date,o.user=r.body.user,o.unexpected=r.body.unexpected,o.project=r.body.project,o.category=r.body.category,o.description=r.body.description,o.scheduled=r.body.scheduled,o.actual=r.body.actual,o.closed=r.body.closed,o.issues=r.body.issues,console.log(o),e.next=17,o.save();case 17:n.json({result:"success"});case 18:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}()),D.delete("/:id",function(){var e=_()(I.a.mark((function e(r,n){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.remove({_id:r.params.id});case 2:n.json({result:"success"});case 3:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}());var X=D,F=n(15),H=n.n(F);w.a.config();var J=E()(),z=process.env.EXCELAPI_URL?process.env.EXCELAPI_URL:"http://localhost:5000",K=H.a.create({baseURL:z,headers:{"Content-Type":"application/json"},responseType:"json"});J.get("/",function(){var e=_()(I.a.mark((function e(r,n){var t,o,s;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={date:{}},void 0!==r.query.user&&(t.user=r.query.user),void 0!==r.query.gte&&(t.date.$gte=r.query.gte),void 0!==r.query.lte&&(t.date.$lte=r.query.lte),e.next=6,B.find(t);case 6:return o=e.sent,e.next=9,K.post("/",{user:r.query.user,achievements:o});case 9:s=e.sent,n.json(s.data);case 11:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}());var Q=J,V=new(0,b.a.Schema)({name:String,text:String}),W=b.a.model("User",V);function Y(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}w.a.config();var Z=a()(),ee=process.env.MONGO_URI?process.env.MONGO_URI:"mongodb://localhost:27017";console.log(ee);if(b.a.connect(ee+"/oshihomimi",{useNewUrlParser:!0,useUnifiedTopology:!0,useFindAndModify:!1,connectTimeoutMS:1e4}).then((function(){console.log("MongoDB Connected.")})).catch((function(e){console.log(e)})),Z.set("views",i.a.join(__dirname,"views")),Z.set("view engine","pug"),Z.use(f()("dev")),Z.use(a.a.json()),Z.use(a.a.urlencoded({extended:!1})),Z.use(d()()),Z.use(a.a.static(i.a.join(__dirname,"public"))),void 0!==process.env.CORS_ORIGIN){var re={origin:process.env.CORS_ORIGIN};Z.use(x()(re))}else Z.use(x()());Z.use("/",q.a),Z.use("/conf",M),Z.use("/task",R),Z.use("/achievement",X),Z.use("/excel",Q),Z.use((function(e,r,n){n(o()(404))})),Z.use((function(e,r,n,t){console.log(e),n.locals.message=e.message,n.locals.error="development"===r.app.get("env")?e:{},n.status(e.status||500),n.render("error")}));var ne,te=function(e,r){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,r){if(!e)return;if("string"==typeof e)return Y(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Y(e,r)}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw s}}}}(n(6).users);try{var oe=function(){var e=ne.value,r=W();r.name=e.value,r.text=e.text,W.findOneAndUpdate({name:r.name},r,{upsert:!0},(function(){console.log("User "+r.name+" Configured.")}))};for(te.s();!(ne=te.n()).done;)oe()}catch(e){te.e(e)}finally{te.f()}var se=function(e){var r=parseInt(e,10);if(isNaN(r))return e;if(r>=0)return r;return!1}(process.env.PORT||"3000");Z.set("port",se);var ae=y.a.createServer(Z);ae.listen(se),ae.on("error",(function(e){if("listen"!==e.syscall)throw e;var r="string"==typeof se?"Pipe "+se:"Port "+se;switch(e.code){case"EACCES":console.error(r+" requires elevated privileges"),process.exit(1);break;case"EADDRINUSE":console.error(r+" is already in use"),process.exit(1);break;default:throw e}})),ae.on("listening",(function(){var e=ae.address(),r="string"==typeof e?"pipe "+e:"port "+e.port;g()("Listening on "+r)}))}]);